原文: http://www.vldb.org/pvldb/vol8/p1816-teller.pdf

## Gorilla: 一个快速可扩展的内存时序数据库


### 序
````
    互联网服务需要保持高度可用性，需要实时故障检测。为了检测互联网和服务的状态，需要每秒查询多次、并且大范围查询。
为此需要一种专门存储类似数据的解决方案(TSDB)。
    一个设计TSDB难点就是如何平衡效率，可伸缩性，和可靠性之间的关系。在这个paper中，会介绍Facebook的TSDB-Gorilla。
我们注意到，在监控系统的场景下，范围聚合查询分析，要比单点查询更重要、和时间相对比较旧的数据点相比，时间比较接近的数据点
更有价值，因为这可以快速诊断、恢复问题。Gorilla对可读写性做了一些优化，即使在面对系统故障，也只是可能在写入的路径上丢弃
一点数据。Gorilla使用了类似时间戳差值法、xor浮点压缩法来提高查询效率。这可以把压缩空间减少10倍，这使得Gorilla可以把数
据直接放在内存里面，把查询效率提高73倍，相比于传统的时间序列数据库(hbase)，吞吐量提高了14倍。这项改进解锁了新的调试工具
例如时间相关的搜索和可视化工具。Gorilla也能优雅的低开销的处理从单点到区域的一系列报错。
````


### 介绍

````
    大型互联网服务聚焦于高可用以及对于他们用户的故障率。随着这些服务的发现，在全球范围内，他们已经在几百台物理机上部署了几千甚至
上万的实例，横跨多个数据中心。
    运维大型系统的一个重要的要求就是可以实时监控服务的健康程度和性能指标，当问题出现的时候他们可以快速修复。facebook使用了一个TS
DB去存储这些指标，并且提供了告诉查询的方法。我们接下来指定一些facebook需要监控的条件，并且用来描述Gorilla。
    **写主导** 为了监控成百上千个不同服务，横跨不同数据中心的上千实例服务。数据写入的速率很容易就可以达到1000w/s。查询主要来自dashboard的请
求。所以数据的写入远远比数据的查询要重要的多。无论任何时候，写入都不应该报错。
    **状态转换** 我们希望在版本更新，网络终端，以及其他异常中找到明显状态异常的问题，所以我们的TSDB应该需要支持数十甚至几秒以内的视窗。
这个数据是很重要的， 因为它允许在问题广泛传播之前进行补救。
    **高可用** 如果网络分区转换，或者其它的失败导致网络不可链接。那我们可以把数据缓存到本地。并且有能力崇川。
    **容错** 我们希望数据会多写。

    Gorilla是一个新的TSDB，可以满足以上要求，Gorilla的大多数请求都可以在10ms内完成。Gorilla不存储用户数据，所以不会保证ACID，但是
    要保证尽量多情况下的数据写入。Gorilla还会尽力保证最近时间的数据。即使系统在1h之前坏掉了，也能保证服务的读写。（代价是损失长时间数据）


````
### 背景和要求
#### ODS
    运维数据在facebook很重要
    架构： server <- Gorilla -> hbase 
                       |
                       |
                       | ->   alert/dashboard
    消费者有两个: 
    
    1. 报警系统
    
    2. 工程师去读
   

##### 读取的性能问题
hbase无法即使相应大规模的数据，需要等上数秒。考虑换存储：
hive-不合适，太慢了
内存数据库-缓存miss, 新数据新增有个峰值，会对内存数据库造成极高的负载

#### Gorilla需要支持什么
- 对于一个key，2已条数据
- 700亿个点
- 存储26h的数据
- qps 4w以上
- 响应时间1ms以内
- 15s级别的打点
- 两个分片
- 即使某个分片崩溃，也能读
- 能快速扫描所有的数据
- 每年至少支持2倍增长

### 和其他TSDB的比较
````
Gorilla更专注于实时指标
Gorilla支持最近可用
Gorilla是一个内存数据库，可以作为任何TSDB的缓存。
````

#### OPENTSDB
````
基于hbase，查询性能依赖表结构
OpenTSDB会保证数据的完整性。
有着丰富的数据模型
````

#### Whisper
````
数据存储在磁盘以一种数据库的规范格式
不支持数据抖动，模型时间序列间隔一致。
每个序列都会存储一个文件。
内存会保存一天。
因为专注磁盘，所以性能不会特别好。
````
#### influxdb
````
比opentsdb更多的数据模型
会保存完成的元信息，所以更占磁盘。
支持分布式，不需要额外运维hbase
influxdb磁盘读，所以不会很快。
````


### GORILLA架构
监控数据会被这么写:









### 问题 

这个东西解决了什么问题？

如何解决了上述问题？

目前的现状？

目前存在的问题？

数据模型？

事物是如何实现的?

写入流程？

查询流程？

压缩算法？